# 能量机关识别策略
- [能量机关识别策略](#能量机关识别策略)
  - [R标识别](#r标识别)
  - [扇叶识别](#扇叶识别)
  - [扇叶跟踪](#扇叶跟踪)
  - [打击扇叶的选择](#打击扇叶的选择)
  - [扇叶位置预测](#扇叶位置预测)

## R标识别
目前使用基于二值化后图像中矩形框内的亮度占比来判断是否为R标

> Tip:后期计划使用浅学习模型用来对矩形框内容是否为R标进行判别。

## 扇叶识别
> 模型简化：
> 1. 鉴于能量机关激活点运动区域较小，近似认为能量机关旋转平面和其与相机光心连线垂直。
> 2. ...

在获取到旋转中心在图片中的位置以及光心与能量机关只见那的距离（光心坐标系下R标与原点的距离）
1. 将扇叶旋转半径投影到图像中。
2. 根据比例获取旋转区域圆环的大小圆半径。
3. 在二值图中提取出靶标部分图像（圆环形区域）。
4. 框出大面积有亮度的部分。
5. 将框选部分与旋转圆心连接，得到连线倾斜的角度($\arctan(\frac{\Delta y}{\Delta x})$)。
6. 对倾斜角度进行合并，相差不大的取平均数。
7. 输出每个扇叶简化为线后在图像中的倾斜角度向量（升序）。

## 扇叶跟踪
- 当只有一个扇叶时将其位置直接更新即可，并标上id=0，state=disactive，同时顺时针每隔标定72°标上对应id，state=negative。
- 当出现多个扇叶时，先判断id=0的扇叶在新角度向量中的位置，然后依次更新向量中对应位置的扇叶状态。
  - 先根据0id扇叶旋转72°得到理论位置，再根据检测结果进行数据融合。
- 根据旋转角度及帧率计算每片扇叶旋转的角速度取平均作为整体角速度。

~~也许多叶片的时候可以加入PnP解算？~~

## 打击扇叶的选择
根据亮起扇叶的数量我们可以得到以下结论：
1. 当只有一个扇叶时，该扇叶为待击打扇叶。
2. 当扇叶数量增加时，新出现的扇叶为待击打扇叶。

## 扇叶位置预测
